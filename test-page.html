<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BetterGPT Test Page</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            line-height: 1.6;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .section h2 {
            margin-top: 0;
            color: #007bff;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        .output {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-height: 100px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        .info {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
        }
        .kbd {
            background: #f4f4f4;
            border: 1px solid #ccc;
            border-radius: 3px;
            padding: 2px 6px;
            font-family: monospace;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <h1>BetterGPT Test Page</h1>
    
    <div class="info">
        <strong>Instructions:</strong>
        <ol>
            <li>Load the extension in Chrome: Go to <code>chrome://extensions/</code></li>
            <li>Enable "Developer mode"</li>
            <li>Click "Load unpacked" and select the <code>dist/</code> folder</li>
            <li>Reload this page</li>
            <li>Try these keyboard shortcuts:
                <ul>
                    <li><span class="kbd">Ctrl+Shift+A</span> - Toggle main UI panel</li>
                    <li><span class="kbd">Cmd/Ctrl+K</span> - Open command palette</li>
                    <li><span class="kbd">Ctrl+Shift+S</span> - Toggle sidebar (on ChatGPT)</li>
                </ul>
            </li>
        </ol>
    </div>

    <div class="section">
        <h2>Phase 5 Features</h2>
        <p>New features added in Phase 5:</p>
        <ul>
            <li><strong>Command Palette:</strong> Press <span class="kbd">Cmd/Ctrl+K</span> to access all commands</li>
            <li><strong>Theme Support:</strong> Toggle between light/dark mode (check command palette or theme toggle button in UI)</li>
            <li><strong>Keyboard Shortcuts:</strong> Centralized keyboard shortcut management</li>
            <li><strong>Virtual Scroll:</strong> Efficient rendering for large lists</li>
            <li><strong>Performance Optimizations:</strong> Database caching, throttling, and batch operations</li>
        </ul>
    </div>

    <div class="section">
        <h2>Keyboard Shortcuts Tests</h2>
        <p>Test the new keyboard shortcut system:</p>
        <button onclick="testCommandPalette()">Test Command Palette (Cmd/Ctrl+K)</button>
        <button onclick="testToggleUI()">Toggle UI (Ctrl+Shift+A)</button>
        <button onclick="testTheme()">Test Theme Toggle</button>
        <div id="shortcuts-output" class="output">Keyboard shortcuts test results will appear here...
        
Try pressing Cmd/Ctrl+K to open the command palette!</div>
    </div>

    <div class="section">
        <h2>UI Tests</h2>
        <p>Test the extension UI and features:</p>
        <button onclick="testShowUI()">Show UI</button>
        <button onclick="testHideUI()">Hide UI</button>
        <button onclick="checkThemeStatus()">Check Current Theme</button>
        <div id="ui-output" class="output">UI test results will appear here...</div>
    </div>

    <div class="section">
        <h2>Database Tests</h2>
        <p>Test IndexedDB and conversation storage:</p>
        <button onclick="testSaveConversation()">Save Test Conversation</button>
        <button onclick="testGetConversations()">Get All Conversations</button>
        <button onclick="testCreateFolder()">Create Test Folder</button>
        <button onclick="testGetFolders()">Get All Folders</button>
        <button onclick="testClearDatabase()">Clear Database</button>
        <div id="db-output" class="output">Database test results will appear here...</div>
    </div>

    <div class="section">
        <h2>Integration Tests</h2>
        <p>Test conversation management features:</p>
        <button onclick="testArchive()">Archive Conversation</button>
        <button onclick="testFavorite()">Favorite Conversation</button>
        <button onclick="testSearch()">Search Conversations</button>
        <button onclick="testBulkOperations()">Test Bulk Operations</button>
        <div id="integration-output" class="output">Integration test results will appear here...</div>
    </div>

    <div class="section">
        <h2>Export Tests (Phase 4)</h2>
        <p>Test export manager functionality:</p>
        <button onclick="testExportJSON()">Export as JSON</button>
        <button onclick="testExportMarkdown()">Export as Markdown</button>
        <button onclick="testExportHTML()">Export as HTML</button>
        <button onclick="testEnableAutoExport()">Enable Auto-Export</button>
        <button onclick="testDisableAutoExport()">Disable Auto-Export</button>
        <div id="export-output" class="output">Export test results will appear here...</div>
    </div>

    <div class="section">
        <h2>Extension Status</h2>
        <button onclick="checkExtensionStatus()">Check Extension Status</button>
        <div id="status-output" class="output">Extension status will appear here...</div>
    </div>

    <script>
        // Keyboard Shortcuts Tests
        function testCommandPalette() {
            const output = document.getElementById('shortcuts-output');
            output.textContent = 'Command Palette Test:\n\n' +
                '1. Press Cmd/Ctrl+K to open the command palette\n' +
                '2. Type to search for commands\n' +
                '3. Use arrow keys to navigate\n' +
                '4. Press Enter to execute a command\n' +
                '5. Press Escape to close\n\n' +
                'Available commands:\n' +
                '- New Conversation\n' +
                '- Toggle Sidebar\n' +
                '- Search Conversations\n' +
                '- Archive Current Conversation\n' +
                '- Toggle Theme\n' +
                '- Export/Import Conversations';
        }

        // UI Tests
        function testToggleUI() {
            chrome.runtime.sendMessage({ type: 'TOGGLE_UI' }, (response) => {
                const output = document.getElementById('shortcuts-output');
                if (chrome.runtime.lastError) {
                    output.textContent = 'Error: ' + chrome.runtime.lastError.message;
                } else {
                    output.textContent = 'Toggle UI response: ' + JSON.stringify(response, null, 2) + '\n\n' +
                        'You can also use Ctrl+Shift+A keyboard shortcut';
                }
            });
        }

        function testTheme() {
            const output = document.getElementById('shortcuts-output');
            output.textContent = 'Theme Toggle Test:\n\n' +
                '1. Open the command palette (Cmd/Ctrl+K)\n' +
                '2. Search for "Toggle Theme"\n' +
                '3. Press Enter to switch themes\n\n' +
                'OR\n\n' +
                '1. Open the main UI (Ctrl+Shift+A)\n' +
                '2. Click the sun/moon icon in the header\n\n' +
                'The theme will persist across sessions!';
        }

        function checkThemeStatus() {
            const output = document.getElementById('ui-output');
            chrome.storage.local.get('theme', (result) => {
                const theme = result.theme || 'system';
                output.textContent = 'Current Theme Setting: ' + theme + '\n\n' +
                    'The extension supports:\n' +
                    '- light: Always use light theme\n' +
                    '- dark: Always use dark theme\n' +
                    '- system: Follow OS preference\n\n' +
                    'Use the command palette or theme toggle to change.';
            });
        }

        function testShowUI() {
            document.getElementById('ui-output').textContent = 
                'Show UI: Press Ctrl+Shift+A to show the UI panel on the right side\n\n' +
                'The UI panel includes:\n' +
                '- Theme toggle button (sun/moon icon)\n' +
                '- Conversation interface\n' +
                '- Settings and options';
        }

        function testHideUI() {
            document.getElementById('ui-output').textContent = 
                'Hide UI: Press Ctrl+Shift+A again to hide the UI panel\n\n' +
                'Or click the X button in the panel header';
        }

        // Database Tests
        async function testSaveConversation() {
            const output = document.getElementById('db-output');
            output.textContent = 'Testing save conversation...';
            
            try {
                // This would normally be done through the extension
                output.textContent = 'Save conversation test initiated.\nCheck browser console for details.';
                console.log('Test: Saving a conversation to IndexedDB');
            } catch (error) {
                output.textContent = 'Error: ' + error.message;
            }
        }

        async function testGetConversations() {
            const output = document.getElementById('db-output');
            output.textContent = 'Getting conversations...';
            
            try {
                output.textContent = 'Get conversations test initiated.\nCheck browser console for details.';
                console.log('Test: Retrieving all conversations from IndexedDB');
            } catch (error) {
                output.textContent = 'Error: ' + error.message;
            }
        }

        async function testCreateFolder() {
            const output = document.getElementById('db-output');
            output.textContent = 'Creating test folder...';
            
            try {
                output.textContent = 'Create folder test initiated.\nCheck browser console for details.';
                console.log('Test: Creating a folder in IndexedDB');
            } catch (error) {
                output.textContent = 'Error: ' + error.message;
            }
        }

        async function testGetFolders() {
            const output = document.getElementById('db-output');
            output.textContent = 'Getting folders...';
            
            try {
                output.textContent = 'Get folders test initiated.\nCheck browser console for details.';
                console.log('Test: Retrieving all folders from IndexedDB');
            } catch (error) {
                output.textContent = 'Error: ' + error.message;
            }
        }

        async function testClearDatabase() {
            const output = document.getElementById('db-output');
            const confirmed = confirm('Are you sure you want to clear the database?');
            
            if (confirmed) {
                output.textContent = 'Clearing database...\nCheck browser console for details.';
                console.log('Test: Clearing IndexedDB');
            } else {
                output.textContent = 'Database clear cancelled.';
            }
        }

        // Integration Tests
        function testArchive() {
            const output = document.getElementById('integration-output');
            output.textContent = 'Archive test: This would archive a conversation.\nCheck browser console for details.';
            console.log('Test: Archive conversation');
        }

        function testFavorite() {
            const output = document.getElementById('integration-output');
            output.textContent = 'Favorite test: This would favorite a conversation.\nCheck browser console for details.';
            console.log('Test: Favorite conversation');
        }

        function testSearch() {
            const output = document.getElementById('integration-output');
            output.textContent = 'Search test: This would search conversations.\nCheck browser console for details.';
            console.log('Test: Search conversations');
        }

        function testBulkOperations() {
            const output = document.getElementById('integration-output');
            output.textContent = 'Bulk operations test: This would perform bulk operations.\nCheck browser console for details.';
            console.log('Test: Bulk operations');
        }

        // Extension Status
        function checkExtensionStatus() {
            const output = document.getElementById('status-output');
            output.textContent = 'Checking extension status...';
            
            chrome.runtime.sendMessage({ type: 'PING' }, (response) => {
                if (chrome.runtime.lastError) {
                    output.textContent = 'Extension not loaded or error:\n' + 
                        chrome.runtime.lastError.message;
                } else {
                    output.textContent = 'Extension is loaded!\n\n' + 
                        'Response: ' + JSON.stringify(response, null, 2) + '\n\n' +
                        'Content script should be initialized.\n' +
                        'Press Ctrl+Shift+A to toggle the UI.';
                }
            });
        }

        // Check extension status on page load
        window.addEventListener('load', () => {
            setTimeout(checkExtensionStatus, 1000);
        });

        // Export Tests (Phase 4)
        function testExportJSON() {
            const output = document.getElementById('export-output');
            output.textContent = 'Export JSON test:\n\n' +
                'This would export a conversation as JSON.\n' +
                'To test: First save a conversation, then trigger export.\n' +
                'Check browser console for details.';
            console.log('Test: Export conversation as JSON');
        }

        function testExportMarkdown() {
            const output = document.getElementById('export-output');
            output.textContent = 'Export Markdown test:\n\n' +
                'This would export a conversation as Markdown.\n' +
                'Format includes title, metadata, and formatted messages.\n' +
                'Check browser console for details.';
            console.log('Test: Export conversation as Markdown');
        }

        function testExportHTML() {
            const output = document.getElementById('export-output');
            output.textContent = 'Export HTML test:\n\n' +
                'This would export a conversation as HTML.\n' +
                'Includes styled formatting for better readability.\n' +
                'Check browser console for details.';
            console.log('Test: Export conversation as HTML');
        }

        function testEnableAutoExport() {
            const output = document.getElementById('export-output');
            output.textContent = 'Auto-export enabled!\n\n' +
                'When enabled, conversations will be automatically exported\n' +
                'when they are completed (after ChatGPT responds).\n' +
                'Default format: Markdown\n\n' +
                'Visit chat.openai.com and start a conversation to test.';
            console.log('Test: Enable auto-export');
        }

        function testDisableAutoExport() {
            const output = document.getElementById('export-output');
            output.textContent = 'Auto-export disabled!\n\n' +
                'Conversations will no longer be automatically exported.\n' +
                'You can still manually export them.';
            console.log('Test: Disable auto-export');
        }
    </script>
</body>
</html>
